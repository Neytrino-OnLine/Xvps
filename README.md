(скрипт написан исключительно для нашего любимого VPS, и не претендует на универсальность и работу с какими-либо другими конфигурациями серверов)
# Xvps - (или) настройка Xkeen в режиме диалога.
<details><summary>Для тех - кто начинает с самого начала...</summary>
  Нам понадобится маршрутизатор Keenetic (или ZyXel Keenetic) с USB-портом (портами) и поддержкой накопителей (к таковым не относятся устройства: 4GII, 4GIII, а так-же бюджетные модели 2024-го года).

Устанавливаем (или, проверяем что они установлены) четыре компонента KeeneticOS:
• Поддержка открытых пакетов
• Протокол IPv6
• Модули ядра подсистемы Netfilter
• Пакет расширения Xtables-addons для Netfilter

Определяемся - будем ли мы использовать "встроенное хранилище" маршрутизатора (если оно не меньше 40-ка мегабайт), или USB-флешку - которую желательно отформатировать в [ext4](https://www.aomeitech.com/pa/standard.html) (хотя, народ вроде пользуется и NTFS-флешками)...

Скачиваем дистрибутива Entware (подходящий для архитектуры процессора вашего роутера): [mipsel](https://bin.entware.net/mipselsf-k3.4/installer/mipsel-installer.tar.gz), [mips](https://bin.entware.net/mipssf-k3.4/installer/mips-installer.tar.gz), [aarch64](https://bin.entware.net/aarch64-k3.10/installer/aarch64-installer.tar.gz)...

Переходим в "Управление/Приложения" (в веб-конфигураторе), в разделе "Диски и принтеры" - открываем накопитель (который будет использоваться для размещения Entware), создаём в корне диска папку "install" (с маленькой буквы) - помещаем в неё архив с дистрибутивом Entware.

Затем, переходим в "Управление/OPKG" и в меню "Накопитель" - выбираем диск с дистрибутивом Entware, нажимаем "Сохранить"...

И дождавшись когда побледневшая кнопка "Сохранить" полностью исчезнет - переходим в "Управление/Диагностика", где нажимаем "Показать журнал". В журнале (один за другим) будут появляться события об устанавке различных модулей Entware, мы ждём события: "Установка системы пакетов Entware - завершена".

Теперь нам понадобится [PuTTY](http://www.putty.org/) (скачиваем, устанавливаем и запускаем его). В поле "Host Name (or IP adress)" - вписываем IP-адрес вашего маршрутизатора (обычно это: 192.168.1.1), в поле "Port" - оставляем "22" (или вводим "222", если до установки Entware в прошивке уже был установлен компонент "Сервер SSH") и нажимаем кнопку "Open"... (При первом подключении) появится окошко с предупреждением (в котором нужно нажать "Accept") и окошко терминала - в котором должен появиться запрос на ввод имени пользователя. Вводим: "root" (в качестве имени), а в качестве пароля: "keenetic" (при вводе пароля - символы отображаться не будут). Если всё правильно - появится приглашение для ввода команд: "~ #"...
</details>

Чтобы начать работать с Xvps, мы просто копируем следующие несколько команд (можно скопировать сразу все):
```
opkg update
opkg install ca-certificates wget-ssl
opkg remove wget-nossl
wget -O /tmp/xvps.sh https://raw.githubusercontent.com/Neytrino-OnLine/Xvps/refs/heads/main/xvps.sh
mv /tmp/xvps.sh /opt/bin/xvps
chmod +x /opt/bin/xvps
```
и вставляем их в терминал (кликом правой кнопки мыши), после последней команды - нужно нажать ввод. В приложение wget будет добавлена поддержка ssh, оно скачает скрипт Xvps, переместит его в каталог "bin" (чтобы можно было вызывать его по имени) и сделает файл исполняемым...

Теперь, можно приступать к работе...

Вводим в консоль:
```
xvps
```
и нажимаем ввод.

![IMG](https://live.staticflickr.com/65535/54173079687_bc37aca4d8_o.png)

Появится скромное меню, в котором нужно выбрать пункт "1" и нажать ввод.
Начнётся установка Xkeen...

![IMG2](https://live.staticflickr.com/65535/54173975801_b398fc783c_o.png)

До определённого момента - всё будет происходить в автоматическом режиме, но потом - установщику понадобятся ответы на несколько вопросов...

![IMG3](https://live.staticflickr.com/65535/54173979716_9ba43e5939_o.png)

(В целях экономии времени) на все вопросы мы ответим отрицательно, вы можете ответить так - как считаете нужным... После получения всех необходимых сведений - установщик выполнит все необходимые действия и завершит свою работу. Прежде - на этом месте заканчивалось всё хорошее, и начинался мучительный процесс - вникания в тонкости устройства конфигурационных *.json-файлов Xray, и попытки изменить настройки (из примеров) под свои нужды (с многочисленными сообщениями об ошибках синтаксиса и т.п.)...
Но не теперь! Нажимаем любую кнопку, и попадаем в существенно расширившееся меню Xvps.

![IMG4](https://live.staticflickr.com/65535/54176796783_04ebc2af77_o.png)

Мы воспользуемся мастером настройки (пункт "6"), который позволит нам (в режиме диалога) поочерёдно настроить все конфигурационные файлы...

![IMG5](https://live.staticflickr.com/65535/54176534866_f65c4cc679_o.png)

Нас приветствует мастер...

![IMG6](https://live.staticflickr.com/65535/54173104352_9234b7936d_o.png)

В качестве демонстрации - мы настроим самый простой вариант. Для этого: откажемся от использования политики Xkeen и добавим одно прокси-подключение на порту 1080 (без авторизации)...

![IMG7](https://live.staticflickr.com/65535/54174001646_02c65788ec_o.png)

По завершению этого этапа настройки, можно посмотреть - как будет выглядеть конфигурация входящих подключений в json и либо начать настройку заново, либо - утвердить результат и переходить к настройке подключений исходящих...

![IMG8](https://live.staticflickr.com/65535/54173116022_deb6a392a3_o.png)

При настройке исходящих подключений - скрипт принимает vless-ключи (больше не нужно разбираться что есть что, или использовать дополнительные программы - разбирающие ключи на составные элементы)...

![IMG9](https://live.staticflickr.com/65535/54174012446_1a48cd5721_o.png)

По итогам - можно (опять же) просмотреть json-версию и решить (устраивает вас результат или нужно настроить исходящие подключения заново)...

![IMG10](https://live.staticflickr.com/65535/54174458725_ec4a8c4a42_o.png)

У нас самая простая конфигурация, так что в маршрутизации у нас будет только одно правило (связывающее входящее подключение с исходящим)...

![IMG11](https://live.staticflickr.com/65535/54174021986_30fdc6db49_o.png)

И снова (по итогам) к нашим услугам json, и теперь можно сохранить всю конфигурацию... (обратите внимание: Xvps - сохраняет файлы только когда ему есть что сохранить, если прервать процесс настройки (до сохранения файлов) - это никак не повлияет на работающую в данный момент конфигурацию)
Ну и чтобы (если вдруг всё перестанет работать) была возможность быстро откатиться назад - Xvps не перезаписывает файлы предыдущей конфигурации, а перемещает их в специальную папку (откуда их можно быстро вернуть на место (если что))...

![IMG12](https://live.staticflickr.com/65535/54174031521_c58bffd374_o.png)

По завершению настройки - возвращаемся в главное меню Xvps, и чтобы изменения вступили в силу - выбираем пункт "2" (который штатными средствами перезапустит Xkeen). Можно пробовать подключаться к прокси (на порту 1080)...

ps.s У Xvps - есть демонстрационный режим:
```
xvps -d
```
Он позволяет пользоваться скриптом без взаимодействия с установленным Xkeen/Xray или вообще без него. В этом режиме можно сгенерировать все файлы настроек (которые будут сохранены в отдельной папке), и затем - перенести их в работающий Xkeen./Xray..
[/spoiler][/hide]
